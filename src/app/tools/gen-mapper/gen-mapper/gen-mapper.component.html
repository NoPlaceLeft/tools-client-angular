<mat-drawer-container (backdropClick)="nodeDrawer.onBackdropClick()"
                      [class.show-map-view]="showMapView">
    <mat-drawer position="end"
                fxLayout="column"
                class="node-drawer"
                [autoFocus]="false"
                (openedChange)="onNodeDrawerOpenChanged($event)">
        <app-node-drawer #nodeDrawer
                         [documents]="documents"
                         [document]="document"
                         [template]="template"
                         [node]="node"
                         [hideActions]="showMapView && tabs?.activeTab?.view === 'googleMap'"
                         (copyNode)="onCopyNode($event)"
                         (pasteNode)="onPasteNode($event)"
                         (updateNode)="onUpdateNode($event)"
                         (importSubtree)="onImportSubtree($event)"></app-node-drawer>
    </mat-drawer>

    <mat-drawer-content>
        <ng-container *ngIf="document; then genMapperGraph else emptyState"></ng-container>
    </mat-drawer-content>
</mat-drawer-container>

<ng-template #genMapperGraph>
    <ng-container *ngIf="document">
        <app-map-name-control [showErrors]="isAuthenticated"></app-map-name-control>
        <app-map-menu-button [document]="document"
                             [template]="template"
                             (print)="onPrint($event)"></app-map-menu-button>
    </ng-container>

    <ng-container *ngIf="showMapView">
        <app-gen-mapper-view-tabs></app-gen-mapper-view-tabs>
    </ng-container>

    <ng-container *ngIf="showMapView && tabs?.activeTab?.view === 'googleMap'; then googleMap else genMapGraph"></ng-container>

    <ng-template #googleMap>
        <app-gen-mapper-map [document]="document"
                            [template]="template"
                            (nodeClick)="onNodeClick($event)"></app-gen-mapper-map>
    </ng-template>

    <ng-template #genMapGraph>
        <app-gen-mapper-graph class="{{template.name}}"
                              (change)="onGraphChange($event)"
                              [document]="document"
                              [template]="template"
                              (nodeClick)="onNodeClick($event)"></app-gen-mapper-graph>
    </ng-template>

</ng-template>
<ng-template #emptyState>
    <div class="empty-state"
         fxFlex
         fxLayout="column"
         fxLayoutAlign="center center">

        <div>
            <mat-icon [class.warn]="!isAuthenticated">warning</mat-icon>
        </div>

        <ng-container *ngIf="isAuthenticated">
            <ng-container *ngIf="documents.length === 0">
                <h1 i18n="en-You_have_no_saved_documents">
                    {{'noSavedDocuments' | locale | async}}
                </h1>
            </ng-container>

            <ng-container *ngIf="documents.length > 0">
                <h1 i18n="en-Please_select_a_document">
                    {{'selectADocument' | locale | async}}
                </h1>
            </ng-container>
        </ng-container>

        <ng-container *ngIf="!isAuthenticated">
            <div fxLayout="column"
                 fxLayoutAlign="center center"
                 class="context">
                <h1>
                    {{'pleaseLoginIn' | locale | async}}
                </h1>

                <div class="login-link">
                    <a [routerLink]="['/login']">
                        - {{'en_Login' | locale | async}} -
                    </a>
                </div>
            </div>
        </ng-container>

        <div fxLayout="row"
             fxLayoutGap="24px">
            <button mat-raised-button
                    color="accent"
                    (click)="onCreateDocument()"
                    i18n="en-Create_Document">
                <ng-container *ngIf="isAuthenticated">
                    {{'createDocument' | locale | async}}
                </ng-container>

                <ng-container *ngIf="!isAuthenticated">
                    {{'continueWithoutSaving' | locale | async}}
                </ng-container>
            </button>

            <ng-container *ngIf="isAuthenticated">
                <button mat-raised-button
                        color="accent"
                        (click)="onImport()"
                        i18n="en-Import_Document">
                    {{'importDocument' | locale | async}}
                </button>
            </ng-container>
        </div>
    </div>
</ng-template>
